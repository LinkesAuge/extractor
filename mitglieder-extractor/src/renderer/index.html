<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline';">
  <title>Member Extractor</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <img src="icon.png" alt="Icon" class="header-icon">
    <h1>Member Extractor</h1>
  </header>

  <!-- Tab Navigation -->
  <nav class="tab-bar" role="tablist">
    <button id="tab-settings-btn" class="tab-btn active" role="tab" aria-selected="true" aria-controls="tab-settings" data-tab="settings" data-i18n="tab.settings">Einstellungen</button>
    <button id="tab-capture-btn" class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-capture" data-tab="capture" data-i18n="tab.capture">Aufnahme &amp; Ergebnisse</button>
    <button id="tab-validation-btn" class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-validation" data-tab="validation" data-i18n="tab.validation">Validierung</button>
    <button id="tab-history-btn" class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-history" data-tab="history" data-i18n="tab.history">History</button>
  </nav>

  <main class="container">

    <!-- ═══════════════════════════════════════════════════════════════ -->
    <!-- TAB 1: EINSTELLUNGEN                                          -->
    <!-- ═══════════════════════════════════════════════════════════════ -->
    <div id="tab-settings" class="tab-content active" role="tabpanel" aria-labelledby="tab-settings-btn">

      <!-- Language Section -->
      <section class="section">
        <h2 class="section-title" data-i18n="section.language">Sprache</h2>
        <div class="control-row">
          <label class="label" for="appLanguageSelect" data-i18n="label.appLanguage">App-Sprache:</label>
          <select id="appLanguageSelect" class="input input-select">
            <option value="de">Deutsch</option>
            <option value="en">English</option>
          </select>
        </div>
      </section>

      <!-- Browser Section -->
      <section class="section">
        <h2 class="section-title" data-i18n="section.browser">Browser</h2>
        <div class="row">
          <input type="text" id="urlInput" class="input" value="https://totalbattle.com/de/" data-i18n-placeholder="placeholder.url" placeholder="URL eingeben...">
          <button id="btnLaunch" class="btn btn-primary" data-i18n="btn.launch">Starten</button>
          <button id="btnClose" class="btn btn-danger" disabled data-i18n="btn.close">Schliessen</button>
        </div>
        <div id="browserStatus" class="status-bar" data-i18n="status.notStarted">Nicht gestartet</div>
      </section>

      <!-- Login Section -->
      <section class="section">
        <h2 class="section-title">
          <span data-i18n="section.autoLogin">Auto-Login</span>
          <label class="toggle-label">
            <input type="checkbox" id="autoLoginEnabled" class="toggle-checkbox">
            <span class="toggle-text" id="autoLoginToggleText" data-i18n="toggle.off">Aus</span>
          </label>
        </h2>
        <div id="loginFields" class="login-fields" style="display:none;">
          <div class="control-row">
            <label class="label" for="loginEmail" data-i18n="label.email">E-Mail:</label>
            <input type="text" id="loginEmail" class="input" data-i18n-placeholder="placeholder.email" placeholder="deine@email.de" autocomplete="off">
          </div>
          <div class="control-row">
            <label class="label" for="loginPassword" data-i18n="label.password">Passwort:</label>
            <div class="password-row">
              <input type="password" id="loginPassword" class="input" data-i18n-placeholder="placeholder.password" placeholder="Passwort" autocomplete="off">
              <button id="btnTogglePassword" class="btn btn-small btn-secondary" type="button" data-i18n="btn.showPassword">Zeigen</button>
            </div>
          </div>
          <div class="login-hint" data-i18n="hint.loginStorage">Daten werden lokal in mitglieder-config.json gespeichert (nicht verschluesselt).</div>
        </div>
      </section>

      <!-- Sub-Tab Navigation fuer Settings -->
      <div class="sub-tab-bar" id="settingsSubTabBar" role="tablist">
        <button id="subtab-settings-member-btn" class="sub-tab-btn active" role="tab" aria-selected="true" aria-controls="settings-member" data-subtab="settings-member" data-i18n="subtab.member">Mitglieder</button>
        <button id="subtab-settings-event-btn" class="sub-tab-btn" role="tab" aria-selected="false" aria-controls="settings-event" data-subtab="settings-event" data-i18n="subtab.event">Event</button>
      </div>

      <!-- ═══ Sub-Tab: Mitglieder Einstellungen ═══ -->
      <div id="settings-member" class="sub-tab-content active" role="tabpanel" aria-labelledby="subtab-settings-member-btn">

      <!-- Region Section -->
      <section class="section" id="regionSection">
        <h2 class="section-title" data-i18n="section.region">Region</h2>
        <div class="row">
          <button id="btnSelectRegion" class="btn btn-primary" disabled data-i18n="btn.selectRegion">Region auswaehlen</button>
          <span id="regionInfo" class="info-text" data-i18n="status.noRegion">Keine Region ausgewaehlt</span>
        </div>
        <div id="regionPreviewContainer" class="preview-container" style="display:none;">
          <img id="regionPreview" class="preview-img" alt="Region Preview">
        </div>
      </section>

      <!-- Calibration Section -->
      <section class="section" id="calibrationSection">
        <h2 class="section-title" data-i18n="section.calibration">Kalibrierung</h2>
        <div class="control-row">
          <label class="label has-tooltip" for="scrollDistance" data-i18n="label.scrollDistance" data-i18n-tooltip="tooltip.scrollDistance" data-tooltip="Scroll-Distanz in Pixeln zwischen Screenshots. Hoehere Werte = groesserer Scroll-Abstand.">Scroll-Distanz (px):</label>
          <input type="range" id="scrollDistance" class="slider" min="1" max="2000" step="10" value="500">
          <span id="scrollDistanceValue" class="slider-value">500</span>
        </div>
        <div class="control-row">
          <label class="label has-tooltip" for="scrollDelay" data-i18n="label.scrollDelay" data-i18n-tooltip="tooltip.scrollDelay" data-tooltip="Wartezeit in Millisekunden nach dem Scrollen, bevor der naechste Screenshot gemacht wird. Laengere Wartezeit = stabilere Bilder.">Scroll-Delay (ms):</label>
          <input type="range" id="scrollDelay" class="slider" min="100" max="2000" step="50" value="500">
          <span id="scrollDelayValue" class="slider-value">500</span>
        </div>
        <div class="row" style="margin-top: 8px;">
          <button id="btnTestScroll" class="btn btn-secondary" disabled data-i18n="btn.testScroll">Test-Scroll</button>
          <span id="testInfo" class="info-text"></span>
        </div>
        <div id="testPreviewContainer" class="test-preview-container" style="display:none;">
          <div class="test-preview-item">
            <span class="test-preview-label" data-i18n="label.before">Vorher</span>
            <img id="testBefore" class="preview-img" alt="Before">
          </div>
          <div class="test-preview-item">
            <span class="test-preview-label" data-i18n="label.after">Nachher</span>
            <img id="testAfter" class="preview-img" alt="After">
          </div>
        </div>
      </section>

      <!-- Capture Settings -->
      <section class="section" id="captureSection">
        <h2 class="section-title" data-i18n="section.capture">Capture</h2>
        <div class="control-row">
          <label class="label has-tooltip" for="maxScreenshots" data-i18n="label.maxScreenshots" data-i18n-tooltip="tooltip.maxScreenshots" data-tooltip="Maximale Anzahl von Screenshots pro Capture-Durchlauf. Der Capture stoppt automatisch bei Duplikat-Erkennung oder dieser Grenze.">Max Screenshots:</label>
          <input type="number" id="maxScreenshots" class="input input-small" value="50" min="1" max="1000">
        </div>
        <div class="control-row">
          <label class="label has-tooltip" for="outputDir" data-i18n="label.outputDir" data-i18n-tooltip="tooltip.outputDir" data-tooltip="Ordner in dem die Screenshots gespeichert werden. Pro Durchlauf wird ein Unterordner mit Zeitstempel erstellt.">Ausgabeordner:</label>
          <input type="text" id="outputDir" class="input" value="./captures/mitglieder">
          <button id="btnBrowseDir" class="btn btn-small btn-secondary" data-i18n="btn.browse">Durchsuchen</button>
          <button id="btnOpenOutputDir" class="btn btn-small btn-secondary" data-i18n="btn.open">Oeffnen</button>
        </div>
      </section>

      <!-- OCR Settings -->
      <section class="section" id="ocrSettingsSection">
        <h2 class="section-title">
          <span data-i18n="section.ocrSettings">OCR Einstellungen</span>
          <div class="section-title-actions" style="gap: 12px;">
            <label class="toggle-label has-tooltip" data-i18n-tooltip="tooltip.autoOcr" data-tooltip="Startet OCR automatisch nach jedem Capture-Durchlauf.">
              <span class="toggle-hint" data-i18n="toggle.autoOcr">Auto-OCR</span>
              <input type="checkbox" id="autoOcrEnabled" class="toggle-checkbox" checked>
              <span class="toggle-text" id="autoOcrToggleText" data-i18n="toggle.on">An</span>
            </label>
            <label class="toggle-label has-tooltip" data-i18n-tooltip="tooltip.autoValidation" data-tooltip="Validiert OCR-Ergebnisse automatisch gegen die Validierungsliste. Bei Fehlern wird ein Hinweis angezeigt.">
              <span class="toggle-hint" data-i18n="toggle.autoValidation">Auto-Valid.</span>
              <input type="checkbox" id="autoValidationEnabled" class="toggle-checkbox" checked>
              <span class="toggle-text" id="autoValidationToggleText" data-i18n="toggle.on">An</span>
            </label>
            <label class="toggle-label has-tooltip" data-i18n-tooltip="tooltip.autoSave" data-tooltip="Speichert die CSV-Datei automatisch wenn die Validierung fehlerfrei ist (alle Namen bestaetigt/korrigiert).">
              <span class="toggle-hint" data-i18n="toggle.autoSave">Auto-Save</span>
              <input type="checkbox" id="autoSaveEnabled" class="toggle-checkbox" checked>
              <span class="toggle-text" id="autoSaveToggleText" data-i18n="toggle.on">An</span>
            </label>
          </div>
        </h2>
        <!-- Engine Selector -->
        <div class="engine-selector">
          <label class="engine-option">
            <input type="radio" name="ocr-engine" value="tesseract" checked>
            <span data-i18n="engine.tesseract">Tesseract (Built-in)</span>
            <small class="engine-hint" data-i18n="engine.tesseractHint">Empfohlen fuer die meisten Nutzer</small>
          </label>
          <label class="engine-option">
            <input type="radio" name="ocr-engine" value="vision">
            <span data-i18n="engine.vision">Vision Model (Advanced)</span>
            <small class="engine-hint" data-i18n="engine.visionHint">Lokale KI-Modelle fuer bessere Erkennung</small>
          </label>
          <label class="engine-option">
            <input type="radio" name="ocr-engine" value="hybrid">
            <span data-i18n="engine.hybrid">Hybrid (Vision + Tesseract)</span>
            <small class="engine-hint" data-i18n="engine.hybridHint">Vision fuer Namen, Tesseract fuer Scores</small>
          </label>
        </div>

        <!-- Tesseract-specific settings -->
        <div id="tesseract-settings">
        <div class="ocr-settings-grid">
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.scale" data-i18n-tooltip="tooltip.scale" data-tooltip="Vergroesserungsfaktor fuer die Bildvorverarbeitung. Groessere Werte (3-4x) verbessern die OCR-Erkennung, erhoehen aber die Verarbeitungszeit.">Skalierung:</label>
            <input type="range" id="ocrScale" class="slider" min="1" max="4" step="0.5" value="3">
            <span id="ocrScaleValue" class="slider-value">3x</span>
          </div>
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.greyscale" data-i18n-tooltip="tooltip.greyscale" data-tooltip="Konvertiert das Bild in Graustufen. Kann die Erkennung bei farbigem Hintergrund verbessern und dient als Verifikations-Pass fuer Scores.">Graustufen:</label>
            <label class="toggle-label">
              <input type="checkbox" id="ocrGreyscale" class="toggle-checkbox" checked>
              <span class="toggle-text" id="ocrGreyscaleText" data-i18n="toggle.on">An</span>
            </label>
          </div>
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.sharpen" data-i18n-tooltip="tooltip.sharpen" data-tooltip="Schaerfe-Sigma fuer Bildschaerfung. Werte um 0.3 sind optimal fuer TotalBattle. 0 = keine Schaerfung, hoehere Werte koennen Artefakte erzeugen.">Schaerfe (sigma):</label>
            <input type="range" id="ocrSharpen" class="slider" min="0" max="3" step="0.1" value="0.3">
            <span id="ocrSharpenValue" class="slider-value">0.3</span>
          </div>
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.contrast" data-i18n-tooltip="tooltip.contrast" data-tooltip="Kontrast-Multiplikator. 1.0 = unveraendert. Hoehere Werte (1.5-2.0) machen helle Bereiche heller und dunkle dunkler, was die Text-Erkennung verbessern kann.">Kontrast:</label>
            <input type="range" id="ocrContrast" class="slider" min="1" max="3" step="0.1" value="1.5">
            <span id="ocrContrastValue" class="slider-value">1.5</span>
          </div>
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.threshold" data-i18n-tooltip="tooltip.threshold" data-tooltip="Binarisierung: Pixel ueber dem Schwellwert werden weiss, darunter schwarz. Hilfreich fuer klare Text/Hintergrund-Trennung. Werte um 128-160 sind typisch.">Schwellwert:</label>
            <label class="toggle-label" style="min-width: 60px;">
              <input type="checkbox" id="ocrThresholdEnabled" class="toggle-checkbox" checked>
              <span class="toggle-text" id="ocrThresholdText" data-i18n="toggle.on">An</span>
            </label>
            <input type="range" id="ocrThresholdVal" class="slider" min="50" max="230" value="152">
            <span id="ocrThresholdDisplay" class="slider-value">152</span>
          </div>
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.psm" data-i18n-tooltip="tooltip.psm" data-tooltip="Tesseract Page Segmentation Mode. Bestimmt wie der Text im Bild gesucht wird. 'Einheitlicher Block' (PSM 6) ist optimal fuer die Sub-Region-Erkennung.">PSM-Modus:</label>
            <select id="ocrPsm" class="input input-select">
              <option value="3" data-i18n="option.automatic">Automatisch</option>
              <option value="4" data-i18n="option.singleColumn">Einzelne Spalte</option>
              <option value="6" selected data-i18n="option.uniformBlock">Einheitlicher Block (Standard)</option>
              <option value="11" data-i18n="option.sparseText">Sparse Text</option>
              <option value="12" data-i18n="option.sparseTextOsd">Sparse Text + OSD</option>
            </select>
          </div>
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.ocrLang" data-i18n-tooltip="tooltip.ocrLang" data-tooltip="OCR-Sprache fuer die Texterkennung. Deutsch ist optimal fuer TotalBattle DE. 'Deutsch + Englisch' kann bei gemischten Texten helfen.">Sprache:</label>
            <select id="ocrLang" class="input input-select">
              <option value="deu" selected data-i18n="option.german">Deutsch</option>
              <option value="eng" data-i18n="option.english">Englisch</option>
              <option value="deu+eng" data-i18n="option.germanEnglish">Deutsch + Englisch</option>
            </select>
          </div>
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.minScore" data-i18n-tooltip="tooltip.minScore" data-tooltip="Mindest-Score fuer die Erkennung. Zahlen unter diesem Wert werden als Artefakte ignoriert und nicht als Score gewertet.">Min. Score:</label>
            <input type="number" id="ocrMinScore" class="input input-small" value="5000" min="0" max="1000000" step="1000">
          </div>
        </div>
        </div><!-- /tesseract-settings -->

        <!-- Vision Model settings (populated by ollama-ui.js) -->
        <div id="vision-settings" style="display: none;"></div>
      </section>

      </div><!-- /settings-member -->

      <!-- ═══ Sub-Tab: Event Einstellungen ═══ -->
      <div id="settings-event" class="sub-tab-content" role="tabpanel" aria-labelledby="subtab-settings-event-btn">

      <!-- Event Region Section -->
      <section class="section" id="eventRegionSection">
        <h2 class="section-title" data-i18n="section.eventRegion">Event-Region</h2>
        <div class="row">
          <button id="btnSelectEventRegion" class="btn btn-primary" disabled data-i18n="btn.selectEventRegion">Event-Region auswaehlen</button>
          <span id="eventRegionInfo" class="info-text" data-i18n="status.noRegion">Keine Region ausgewaehlt</span>
        </div>
        <div id="eventRegionPreviewContainer" class="preview-container" style="display:none;">
          <img id="eventRegionPreview" class="preview-img" alt="Event Region Preview">
        </div>
      </section>

      <!-- Event Calibration Section -->
      <section class="section" id="eventCalibrationSection">
        <h2 class="section-title" data-i18n="section.eventCalibration">Event-Kalibrierung</h2>
        <div class="control-row">
          <label class="label has-tooltip" for="eventScrollDistance" data-i18n="label.scrollDistance" data-i18n-tooltip="tooltip.scrollDistance" data-tooltip="Scroll-Distanz in Pixeln zwischen Screenshots.">Scroll-Distanz (px):</label>
          <input type="range" id="eventScrollDistance" class="slider" min="1" max="2000" step="10" value="500">
          <span id="eventScrollDistanceValue" class="slider-value">500</span>
        </div>
        <div class="control-row">
          <label class="label has-tooltip" for="eventScrollDelay" data-i18n="label.scrollDelay" data-i18n-tooltip="tooltip.scrollDelay" data-tooltip="Wartezeit in Millisekunden nach dem Scrollen.">Scroll-Delay (ms):</label>
          <input type="range" id="eventScrollDelay" class="slider" min="100" max="2000" step="50" value="500">
          <span id="eventScrollDelayValue" class="slider-value">500</span>
        </div>
        <div class="row" style="margin-top: 8px;">
          <button id="btnTestEventScroll" class="btn btn-secondary" disabled data-i18n="btn.testEventScroll">Test-Scroll</button>
          <span id="eventTestInfo" class="info-text"></span>
        </div>
        <div id="eventTestPreviewContainer" class="test-preview-container" style="display:none;">
          <div class="test-preview-item">
            <span class="test-preview-label" data-i18n="label.before">Vorher</span>
            <img id="eventTestBefore" class="preview-img" alt="Before">
          </div>
          <div class="test-preview-item">
            <span class="test-preview-label" data-i18n="label.after">Nachher</span>
            <img id="eventTestAfter" class="preview-img" alt="After">
          </div>
        </div>
      </section>

      <!-- Event Capture Settings -->
      <section class="section" id="eventCaptureSection">
        <h2 class="section-title" data-i18n="section.eventCapture">Event-Capture</h2>
        <div class="control-row">
          <label class="label has-tooltip" for="eventMaxScreenshots" data-i18n="label.maxScreenshots" data-i18n-tooltip="tooltip.maxScreenshots" data-tooltip="Maximale Anzahl von Screenshots pro Capture-Durchlauf.">Max Screenshots:</label>
          <input type="number" id="eventMaxScreenshots" class="input input-small" value="50" min="1" max="1000">
        </div>
        <div class="control-row">
          <label class="label has-tooltip" for="eventOutputDir" data-i18n="label.outputDir" data-i18n-tooltip="tooltip.outputDir" data-tooltip="Ordner in dem die Event-Screenshots gespeichert werden.">Ausgabeordner:</label>
          <input type="text" id="eventOutputDir" class="input" value="./captures/events">
          <button id="btnBrowseEventDir" class="btn btn-small btn-secondary" data-i18n="btn.browse">Durchsuchen</button>
          <button id="btnOpenEventOutputDir" class="btn btn-small btn-secondary" data-i18n="btn.open">Oeffnen</button>
        </div>
      </section>

      <!-- Event OCR Settings -->
      <section class="section" id="eventOcrSettingsSection">
        <h2 class="section-title">
          <span data-i18n="section.eventOcrSettings">Event-OCR Einstellungen</span>
          <div class="section-title-actions" style="gap: 12px;">
            <label class="toggle-label has-tooltip" data-i18n-tooltip="tooltip.autoOcr">
              <span class="toggle-hint" data-i18n="toggle.autoOcr">Auto-OCR</span>
              <input type="checkbox" id="eventAutoOcrEnabled" class="toggle-checkbox" checked>
              <span class="toggle-text" id="eventAutoOcrToggleText" data-i18n="toggle.on">An</span>
            </label>
            <label class="toggle-label has-tooltip" data-i18n-tooltip="tooltip.autoValidation">
              <span class="toggle-hint" data-i18n="toggle.autoValidation">Auto-Valid.</span>
              <input type="checkbox" id="eventAutoValidationEnabled" class="toggle-checkbox" checked>
              <span class="toggle-text" id="eventAutoValidationToggleText" data-i18n="toggle.on">An</span>
            </label>
            <label class="toggle-label has-tooltip" data-i18n-tooltip="tooltip.autoSave">
              <span class="toggle-hint" data-i18n="toggle.autoSave">Auto-Save</span>
              <input type="checkbox" id="eventAutoSaveEnabled" class="toggle-checkbox" checked>
              <span class="toggle-text" id="eventAutoSaveToggleText" data-i18n="toggle.on">An</span>
            </label>
          </div>
        </h2>
        <div class="ocr-settings-grid">
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.scale" data-i18n-tooltip="tooltip.scale">Skalierung:</label>
            <input type="range" id="eventOcrScale" class="slider" min="1" max="4" step="0.5" value="3">
            <span id="eventOcrScaleValue" class="slider-value">3x</span>
          </div>
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.greyscale" data-i18n-tooltip="tooltip.greyscale">Graustufen:</label>
            <label class="toggle-label">
              <input type="checkbox" id="eventOcrGreyscale" class="toggle-checkbox">
              <span class="toggle-text" id="eventOcrGreyscaleText" data-i18n="toggle.off">Aus</span>
            </label>
          </div>
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.sharpen" data-i18n-tooltip="tooltip.sharpen">Schaerfe (sigma):</label>
            <input type="range" id="eventOcrSharpen" class="slider" min="0" max="3" step="0.1" value="0.3">
            <span id="eventOcrSharpenValue" class="slider-value">0.3</span>
          </div>
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.contrast" data-i18n-tooltip="tooltip.contrast">Kontrast:</label>
            <input type="range" id="eventOcrContrast" class="slider" min="1" max="3" step="0.1" value="1.5">
            <span id="eventOcrContrastValue" class="slider-value">1.5</span>
          </div>
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.threshold" data-i18n-tooltip="tooltip.threshold">Schwellwert:</label>
            <label class="toggle-label" style="min-width: 60px;">
              <input type="checkbox" id="eventOcrThresholdEnabled" class="toggle-checkbox">
              <span class="toggle-text" id="eventOcrThresholdText" data-i18n="toggle.off">Aus</span>
            </label>
            <input type="range" id="eventOcrThresholdVal" class="slider" min="50" max="230" value="152" disabled>
            <span id="eventOcrThresholdDisplay" class="slider-value">152</span>
          </div>
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.psm" data-i18n-tooltip="tooltip.psm">PSM-Modus:</label>
            <select id="eventOcrPsm" class="input input-select">
              <option value="3" data-i18n="option.automatic">Automatisch</option>
              <option value="4" data-i18n="option.singleColumn">Einzelne Spalte</option>
              <option value="6" selected data-i18n="option.uniformBlock">Einheitlicher Block (Standard)</option>
              <option value="11" data-i18n="option.sparseText">Sparse Text</option>
              <option value="12" data-i18n="option.sparseTextOsd">Sparse Text + OSD</option>
            </select>
          </div>
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.ocrLang" data-i18n-tooltip="tooltip.ocrLang">Sprache:</label>
            <select id="eventOcrLang" class="input input-select">
              <option value="deu" selected data-i18n="option.german">Deutsch</option>
              <option value="eng" data-i18n="option.english">Englisch</option>
              <option value="deu+eng" data-i18n="option.germanEnglish">Deutsch + Englisch</option>
            </select>
          </div>
          <div class="control-row">
            <label class="label has-tooltip" data-i18n="label.minScore" data-i18n-tooltip="tooltip.minScore">Min. Score:</label>
            <input type="number" id="eventOcrMinScore" class="input input-small" value="5000" min="0" max="1000000" step="1000">
          </div>
        </div>
      </section>

      </div><!-- /settings-event -->

    </div>

    <!-- ═══════════════════════════════════════════════════════════════ -->
    <!-- TAB 2: AUFNAHME & ERGEBNISSE                                  -->
    <!-- ═══════════════════════════════════════════════════════════════ -->
    <div id="tab-capture" class="tab-content" role="tabpanel" aria-labelledby="tab-capture-btn">

      <!-- Sub-Tab Navigation fuer Capture -->
      <div class="sub-tab-bar" id="captureSubTabBar" role="tablist">
        <button id="subtab-capture-member-btn" class="sub-tab-btn active" role="tab" aria-selected="true" aria-controls="capture-member" data-subtab="capture-member" data-i18n="subtab.member">Mitglieder</button>
        <button id="subtab-capture-event-btn" class="sub-tab-btn" role="tab" aria-selected="false" aria-controls="capture-event" data-subtab="capture-event" data-i18n="subtab.event">Event</button>
      </div>

      <!-- ═══ Sub-Tab: Mitglieder Capture ═══ -->
      <div id="capture-member" class="sub-tab-content active" role="tabpanel" aria-labelledby="subtab-capture-member-btn">

      <!-- Capture Controls -->
      <section class="section">
        <h2 class="section-title" data-i18n="section.capture">Capture</h2>
        <div class="row">
          <button id="btnStartCapture" class="btn btn-accent" disabled data-i18n="btn.startCapture">Capture starten</button>
          <button id="btnStopCapture" class="btn btn-danger" disabled data-i18n="btn.stop">Stop</button>
        </div>
        <div id="progressContainer" class="progress-container" style="display:none;">
          <div class="progress-bar">
            <div id="progressFill" class="progress-fill"></div>
          </div>
          <span id="progressText" class="progress-text">0 / 50</span>
        </div>
      </section>

      <!-- Gallery Section -->
      <section class="section" id="gallerySection" style="display:none;">
        <h2 class="section-title">
          <span data-i18n="section.gallery">Galerie</span>
          <div class="section-title-actions">
            <button id="btnOpenFolder" class="btn btn-small btn-secondary" data-i18n="btn.openFolder">Ordner oeffnen</button>
            <button id="btnDeleteCapture" class="btn btn-small btn-danger" data-i18n="btn.deleteCapture">Capture loeschen</button>
          </div>
        </h2>
        <div id="gallery" class="gallery"></div>
        <div id="captureResult" class="result-text"></div>
      </section>

      <!-- Auswertung Section -->
      <section class="section" id="auswertungSection">
        <h2 class="section-title" data-i18n="section.evaluation">Auswertung (OCR)</h2>
        <div class="control-row">
          <label class="label" for="ocrFolder" data-i18n="label.captureFolder">Capture-Ordner:</label>
          <input type="text" id="ocrFolder" class="input" data-i18n-placeholder="placeholder.ocrFolder" placeholder="Ordner mit Screenshots...">
          <button id="btnBrowseOcrFolder" class="btn btn-small btn-secondary" data-i18n="btn.browse">Durchsuchen</button>
          <button id="btnOpenOcrFolder" class="btn btn-small btn-secondary" data-i18n="btn.open">Oeffnen</button>
        </div>
        <div class="row" style="margin-top: 8px;">
          <button id="btnStartOcr" class="btn btn-primary" data-i18n="btn.evaluate">Auswerten</button>
          <button id="btnStopOcr" class="btn btn-danger" disabled data-i18n="btn.stop">Stop</button>
          <span id="ocrStatus" class="info-text"></span>
        </div>
        <div id="ocrProgressContainer" class="progress-container" style="display:none;">
          <div class="progress-bar">
            <div id="ocrProgressFill" class="progress-fill"></div>
          </div>
          <span id="ocrProgressText" class="progress-text">0 / 0</span>
        </div>
        <div id="ocrResultContainer" style="display:none;">
          <div class="ocr-result-header">
            <span id="ocrResultCount" class="result-text"></span>
            <button id="btnExportCsv" class="btn btn-small btn-accent" data-i18n="btn.exportCsv">CSV exportieren</button>
          </div>
          <div class="ocr-table-container">
            <table class="ocr-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th data-i18n="th.name">Name</th>
                  <th data-i18n="th.coords">Koordinaten</th>
                  <th data-i18n="th.score">Score</th>
                </tr>
              </thead>
              <tbody id="ocrTableBody"></tbody>
            </table>
          </div>
        </div>
        <!-- Validierungs-Hinweis im Aufnahme-Tab -->
        <div id="ocrValidationBanner" class="ocr-validation-banner" style="display:none;">
          <span id="ocrValidationIcon" class="ocr-validation-icon"></span>
          <span id="ocrValidationMsg" class="ocr-validation-msg"></span>
          <button id="btnGoToValidation" class="btn btn-small btn-primary" data-i18n="btn.goToValidation">Zur Validierung</button>
        </div>
      </section>

      </div><!-- /capture-member -->

      <!-- ═══ Sub-Tab: Event Capture ═══ -->
      <div id="capture-event" class="sub-tab-content" role="tabpanel" aria-labelledby="subtab-capture-event-btn">

      <!-- Event Capture Controls -->
      <section class="section">
        <h2 class="section-title" data-i18n="section.eventCapture">Event-Capture</h2>
        <div class="row">
          <button id="btnStartEventCapture" class="btn btn-accent" disabled data-i18n="btn.startEventCapture">Event-Capture starten</button>
          <button id="btnStopEventCapture" class="btn btn-danger" disabled data-i18n="btn.stop">Stop</button>
        </div>
        <div id="eventProgressContainer" class="progress-container" style="display:none;">
          <div class="progress-bar">
            <div id="eventProgressFill" class="progress-fill"></div>
          </div>
          <span id="eventProgressText" class="progress-text">0 / 50</span>
        </div>
      </section>

      <!-- Event Gallery Section -->
      <section class="section" id="eventGallerySection" style="display:none;">
        <h2 class="section-title">
          <span data-i18n="section.eventGallery">Event-Galerie</span>
          <div class="section-title-actions">
            <button id="btnOpenEventFolder" class="btn btn-small btn-secondary" data-i18n="btn.openFolder">Ordner oeffnen</button>
            <button id="btnDeleteEventCapture" class="btn btn-small btn-danger" data-i18n="btn.deleteCapture">Capture loeschen</button>
          </div>
        </h2>
        <div id="eventGallery" class="gallery"></div>
        <div id="eventCaptureResult" class="result-text"></div>
      </section>

      <!-- Event Auswertung Section -->
      <section class="section" id="eventAuswertungSection">
        <h2 class="section-title" data-i18n="section.eventEvaluation">Event-Auswertung (OCR)</h2>
        <div class="control-row">
          <label class="label" for="eventOcrFolder" data-i18n="label.eventCaptureFolder">Event-Capture-Ordner:</label>
          <input type="text" id="eventOcrFolder" class="input" data-i18n-placeholder="placeholder.eventOcrFolder" placeholder="Ordner mit Event-Screenshots...">
          <button id="btnBrowseEventOcrFolder" class="btn btn-small btn-secondary" data-i18n="btn.browse">Durchsuchen</button>
          <button id="btnOpenEventOcrFolder" class="btn btn-small btn-secondary" data-i18n="btn.open">Oeffnen</button>
        </div>
        <div class="row" style="margin-top: 8px;">
          <button id="btnStartEventOcr" class="btn btn-primary" data-i18n="btn.eventEvaluate">Auswerten</button>
          <button id="btnStopEventOcr" class="btn btn-danger" disabled data-i18n="btn.stop">Stop</button>
          <span id="eventOcrStatus" class="info-text"></span>
        </div>
        <div id="eventOcrProgressContainer" class="progress-container" style="display:none;">
          <div class="progress-bar">
            <div id="eventOcrProgressFill" class="progress-fill"></div>
          </div>
          <span id="eventOcrProgressText" class="progress-text">0 / 0</span>
        </div>
        <div id="eventOcrResultContainer" style="display:none;">
          <div class="ocr-result-header">
            <span id="eventOcrResultCount" class="result-text"></span>
            <button id="btnExportEventCsv" class="btn btn-small btn-accent" data-i18n="btn.exportEventCsv">Event-CSV exportieren</button>
          </div>
          <div class="ocr-table-container">
            <table class="ocr-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th data-i18n="th.name">Name</th>
                  <th data-i18n="th.power">Macht</th>
                  <th data-i18n="th.eventPoints">Event-Punkte</th>
                </tr>
              </thead>
              <tbody id="eventOcrTableBody"></tbody>
            </table>
          </div>
        </div>
        <!-- Event Validierungs-Hinweis -->
        <div id="eventOcrValidationBanner" class="ocr-validation-banner" style="display:none;">
          <span id="eventOcrValidationIcon" class="ocr-validation-icon"></span>
          <span id="eventOcrValidationMsg" class="ocr-validation-msg"></span>
          <button id="btnGoToEventValidation" class="btn btn-small btn-primary" data-i18n="btn.goToValidation">Zur Validierung</button>
        </div>
      </section>

      </div><!-- /capture-event -->

      <!-- Log Section (shared) -->
      <section class="section">
        <h2 class="section-title log-section-title">
          <span data-i18n="section.log">Log</span>
          <button id="btnCopyLog" class="btn btn-small btn-secondary" data-i18n="btn.copyLog">Kopieren</button>
          <button id="btnOpenLogFolder" class="btn btn-small btn-secondary" data-i18n="btn.openLogFolder">Log-Ordner</button>
          <button id="btnClearLog" class="btn btn-small btn-secondary" data-i18n="btn.clearLog">Log leeren</button>
        </h2>
        <div id="logContainer" class="log-container"></div>
      </section>

    </div>

    <!-- ═══════════════════════════════════════════════════════════════ -->
    <!-- TAB 3: VALIDIERUNG                                             -->
    <!-- ═══════════════════════════════════════════════════════════════ -->
    <div id="tab-validation" class="tab-content" role="tabpanel" aria-labelledby="tab-validation-btn">

      <!-- Sub-Tab Navigation: Mitglieder / Event -->
      <div class="sub-tab-bar" id="validationModeSubTabBar" role="tablist">
        <button id="subtab-validation-member-btn" class="sub-tab-btn active" role="tab" aria-selected="true" aria-controls="validationContent" data-subtab="validation-mode-member" data-i18n="subtab.member">Mitglieder</button>
        <button id="subtab-validation-event-btn" class="sub-tab-btn" role="tab" aria-selected="false" aria-controls="validationContent" data-subtab="validation-mode-event" data-i18n="subtab.event">Event</button>
      </div>

      <!-- Validierungsstatus -->
      <section class="section">
        <h2 class="section-title">
          <span data-i18n="section.validationStatus">Validierungsstatus</span>
          <div class="section-title-actions">
            <span id="validationSummary" class="info-text"></span>
          </div>
        </h2>
      </section>

      <!-- Side-by-Side Layout -->
      <div id="validationContent" class="validation-side-by-side" role="tabpanel" aria-labelledby="subtab-validation-member-btn">

        <!-- Linke Seite: OCR-Ergebnisse -->
        <section class="section validation-panel validation-left-panel">
          <h2 class="section-title">
            <span data-i18n="section.ocrResults">OCR-Ergebnisse</span>
            <div class="section-title-actions">
              <button id="btnAcceptAllSuggestions" class="btn btn-small btn-primary" data-i18n="btn.acceptAllSuggestions">Alle Vorschlaege uebernehmen</button>
            </div>
          </h2>
          <div id="validationEmptyHint" class="validation-empty-hint" data-i18n="hint.validationEmpty">
            Noch keine OCR-Ergebnisse vorhanden. Starte einen OCR-Lauf im Tab "Aufnahme &amp; Ergebnisse".
          </div>
          <div id="validationOcrContent" style="display:none;">
            <div class="validation-filter-row">
              <button class="validation-filter-btn active" data-filter="all" data-i18n="filter.all">Alle</button>
              <button class="validation-filter-btn" data-filter="unknown" data-i18n="filter.unknown">Unbekannt</button>
              <button class="validation-filter-btn" data-filter="suggested" data-i18n="filter.suggested">Vorschlaege</button>
              <button class="validation-filter-btn" data-filter="corrected" data-i18n="filter.corrected">Korrigiert</button>
              <button class="validation-filter-btn" data-filter="confirmed" data-i18n="filter.confirmed">Bestaetigt</button>
              <span class="validation-filter-spacer"></span>
              <button id="btnAddSelectedToList" class="btn btn-small btn-primary" disabled data-i18n="btn.addSelectedToList">Ausgewaehlte zur Liste</button>
            </div>
            <div class="validation-table-container">
              <table class="ocr-table validation-table">
                <thead id="validationOcrHead">
                  <tr>
                    <th class="th-checkbox"><input type="checkbox" id="validationSelectAll" title="Alle auswaehlen"></th>
                    <th data-i18n="th.status">Status</th>
                    <th data-i18n="th.ocrName">OCR-Name</th>
                    <th data-i18n="th.correctionSuggestion">Korrektur / Vorschlag</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="validationOcrBody"></tbody>
              </table>
            </div>
            <div id="validationOcrPagination" class="validation-pagination" style="display:none;"></div>
          </div>
        </section>

        <!-- Rechte Seite: Bekannte Spieler / Korrekturen (Sub-Tabs) -->
        <section class="section validation-panel validation-right-panel">
          <div class="sub-tab-bar" id="validationRightSubTabBar" role="tablist">
            <button id="subtab-validation-players-btn" class="sub-tab-btn active" role="tab" aria-selected="true" aria-controls="validation-players" data-subtab="validation-players" data-i18n="subtab.knownPlayers">Bekannte Spieler</button>
            <button id="subtab-validation-corrections-btn" class="sub-tab-btn" role="tab" aria-selected="false" aria-controls="validation-corrections" data-subtab="validation-corrections" data-i18n="subtab.corrections">Korrekturen</button>
          </div>

          <!-- ═══ Sub-Tab: Bekannte Spieler ═══ -->
          <div id="validation-players" class="sub-tab-content active" role="tabpanel" aria-labelledby="subtab-validation-players-btn">
            <div class="validation-search-row">
              <input type="text" id="validationSearch" class="input" data-i18n-placeholder="placeholder.searchPlayer" placeholder="Spieler suchen...">
              <button id="btnAddValidationName" class="btn btn-small btn-primary" data-i18n-title="btn.addName" title="Name hinzufuegen" data-i18n="btn.addName">+ Hinzufuegen</button>
            </div>
            <span id="validationNameCount" class="info-text validation-count-label"></span>
            <div class="validation-names-container" id="validationNamesContainer">
              <div id="validationNamesList" class="validation-names-list"></div>
            </div>
          </div>

          <!-- ═══ Sub-Tab: Gespeicherte Korrekturen ═══ -->
          <div id="validation-corrections" class="sub-tab-content" role="tabpanel" aria-labelledby="subtab-validation-corrections-btn">
            <div class="correction-add-form">
              <input type="text" id="correctionFromInput" class="input input-small" data-i18n-placeholder="placeholder.correctionFrom" placeholder="OCR-Name (falsch)...">
              <span class="correction-arrow">&rarr;</span>
              <input type="text" id="correctionToInput" class="input input-small" data-i18n-placeholder="placeholder.correctionTo" placeholder="Korrekter Name...">
              <button id="btnAddManualCorrection" class="btn btn-small btn-primary" data-i18n-title="btn.addCorrection" title="Korrektur hinzufuegen">+</button>
            </div>
            <div class="correction-search-row">
              <input type="text" id="correctionSearch" class="input" data-i18n-placeholder="placeholder.searchCorrection" placeholder="Korrektur suchen...">
            </div>
            <span id="correctionCount" class="info-text validation-count-label">0</span>
            <div id="correctionsList" class="validation-corrections-list"></div>
          </div>
        </section>

      </div>

      <!-- Aktionsleiste -->
      <section class="section">
        <h2 class="section-title" data-i18n="section.actions">Aktionen</h2>
        <div class="row" style="gap: 8px; flex-wrap: wrap;">
          <button id="btnValidationExportCsv" class="btn btn-primary" data-i18n="btn.exportCorrectedCsv">Korrigierte CSV exportieren</button>
          <button id="btnImportValidation" class="btn btn-primary" data-i18n="btn.import">Importieren</button>
          <button id="btnExportValidation" class="btn btn-primary" data-i18n="btn.export">Exportieren</button>
          <button id="btnRevalidate" class="btn btn-secondary" data-i18n="btn.revalidate">Erneut validieren</button>
        </div>
      </section>

    </div>

    <!-- ═══════════════════════════════════════════════════════════════ -->
    <!-- TAB 4: HISTORY                                                 -->
    <!-- ═══════════════════════════════════════════════════════════════ -->
    <div id="tab-history" class="tab-content" role="tabpanel" aria-labelledby="tab-history-btn">

      <section class="section">
        <h2 class="section-title">
          <span data-i18n="section.savedResults">Gespeicherte Ergebnisse</span>
          <div class="section-title-actions">
            <button id="btnRefreshHistory" class="btn btn-small btn-secondary" data-i18n="btn.refresh">Aktualisieren</button>
            <button id="btnOpenResultsDir" class="btn btn-small btn-secondary" data-i18n="btn.openResultsDir">Ordner oeffnen</button>
          </div>
        </h2>
        <div id="historyEmptyHint" class="validation-empty-hint" data-i18n-html="hint.historyEmpty">
          Noch keine gespeicherten Ergebnisse. Ergebnisse werden automatisch im <code>results/</code>-Ordner gespeichert.
        </div>
        <div id="historyListContainer" class="history-list-container" style="display:none;">
          <table class="ocr-table history-table">
            <thead>
              <tr>
                <th data-i18n="th.date">Datum</th>
                <th data-i18n="th.type">Typ</th>
                <th data-i18n="th.members">Mitglieder</th>
                <th data-i18n="th.file">Datei</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="historyListBody"></tbody>
          </table>
        </div>
      </section>

      <section class="section" id="historyDetailSection" style="display:none;">
        <h2 class="section-title">
          <span id="historyDetailTitle" data-i18n="history.result">Ergebnis</span>
          <div class="section-title-actions">
            <button id="btnHistoryExportCsv" class="btn btn-small btn-accent" data-i18n="btn.exportCsv">CSV exportieren</button>
          </div>
        </h2>
        <div id="historyDetailCount" class="result-text" style="margin-bottom: 8px;"></div>
        <!-- Member Detail Table -->
        <div id="historyMemberTable" class="ocr-table-container">
          <table class="ocr-table">
            <thead>
              <tr>
                <th>#</th>
                <th data-i18n="th.name">Name</th>
                <th data-i18n="th.coords">Koordinaten</th>
                <th data-i18n="th.score">Score</th>
              </tr>
            </thead>
            <tbody id="historyDetailBody"></tbody>
          </table>
        </div>
        <!-- Event Detail Table -->
        <div id="historyEventTable" class="ocr-table-container" style="display:none;">
          <table class="ocr-table">
            <thead>
              <tr>
                <th>#</th>
                <th data-i18n="th.name">Name</th>
                <th data-i18n="th.power">Macht</th>
                <th data-i18n="th.eventPoints">Event-Punkte</th>
              </tr>
            </thead>
            <tbody id="historyEventDetailBody"></tbody>
          </table>
        </div>
      </section>

    </div>

  </main>

  <!-- Input-Dialog (Ersatz fuer prompt(), das in Electron nicht zuverlaessig funktioniert) -->
  <div id="inputDialog" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="inputDialogTitle" style="display:none;">
    <div class="modal-dialog">
      <h3 id="inputDialogTitle" class="modal-title"></h3>
      <input type="text" id="inputDialogInput" class="input modal-input" autocomplete="off">
      <div class="modal-actions">
        <button id="inputDialogCancel" class="btn btn-secondary" data-i18n="btn.cancel">Abbrechen</button>
        <button id="inputDialogOk" class="btn btn-primary" data-i18n="btn.ok">OK</button>
      </div>
    </div>
  </div>

  <!-- Confirm/Alert-Dialog (Ersatz fuer confirm() und alert()) -->
  <div id="confirmDialog" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="confirmDialogMessage" style="display:none;">
    <div class="modal-dialog">
      <p id="confirmDialogMessage" class="modal-message"></p>
      <div class="modal-actions">
        <button id="confirmDialogCancel" class="btn btn-secondary" data-i18n="btn.cancel">Abbrechen</button>
        <button id="confirmDialogOk" class="btn btn-primary" data-i18n="btn.ok">OK</button>
      </div>
    </div>
  </div>

  <script src="i18n.js"></script>
  <script type="module" src="app.js"></script>
</body>
</html>
